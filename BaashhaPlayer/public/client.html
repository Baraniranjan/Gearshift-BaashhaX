<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ðŸŽ§ BaashaX Multilingual Client</title>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');

    :root {
      --accent: #61dcf4;
      --accent-strong: #4ac8ff;
      --accent-secondary: #0aff9d;
      --warning: #f4c266;
      --warning-strong: #f7a65a;
      --bg-dark: #05070b;
      --glass: rgba(255, 255, 255, 0.06);
      --border-glass: rgba(255, 255, 255, 0.18);
      --shadow-strong: 0 14px 32px rgba(0, 0, 0, 0.85);
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: radial-gradient(circle at top, #0b1220, #000 60%);
      color: #fff;
      margin: 0;
      padding: 20px;
      text-align: center;
    }

    h1 {
      margin-top: 20px;
      font-size: 2.4rem;
      font-weight: 700;
      text-shadow: 0 0 14px rgba(97, 220, 244, 0.55);
    }

    .subtitle {
      font-size: 1rem;
      color: #c2d6e4;
      max-width: 360px;
      margin: 0 auto 25px;
      opacity: 0.8;
      line-height: 1.4;
    }

    /* -------- LANGUAGE BUTTONS -------- */

    #languagePanel {
      width: 100%;
      max-width: 420px;
      margin: 0 auto;
    }

    .language-btn {
      width: 100%;
      padding: 15px;
      margin: 10px 0;
      border: none;
      font-size: 1rem;
      border-radius: 50px;
      background: linear-gradient(90deg, #3a7ef2, #4bd6f5);
      box-shadow: 0 0 16px rgba(109,214,236,0.35);
      font-weight: 600;
      cursor: pointer;
      transition: .25s;
      color: #fff;
    }

    .language-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 26px rgba(112, 220, 241, 0.8);
    }

    .language-btn.active {
      background: linear-gradient(90deg, #4ade96, #4acb82);
      box-shadow: 0 0 26px rgba(74,220,160,0.8);
    }

    /* -------- AUDIO CONTROLS -------- */

    #audioControls {
      display: none;
      margin-top: 26px;
      width: 100%;
      max-width: 500px;
      padding: 20px;
      background: var(--glass);
      border: 1px solid var(--border-glass);
      border-radius: 18px;
      box-shadow: var(--shadow-strong);
      backdrop-filter: blur(12px);
      margin-left: auto;
      margin-right: auto;
    }

    #audioPlayer {
      width: 100%;
      border-radius: 12px;
      margin: 10px 0 16px;
      background: #000;
      box-shadow: 0 0 18px rgba(97, 220, 244, 0.2);
    }

    .sync-btn {
      width: 100%;
      background: linear-gradient(90deg, #4ba2f7, #4bd6f5);
      color: #00141e;
      padding: 12px;
      border: none;
      border-radius: 50px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 10px;
      box-shadow: 0 0 14px rgba(97, 200, 244, 0.6);
      transition: .25s;
    }

    .sync-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 22px rgba(97, 200, 244, 0.9);
    }

    /* -------- STATUS PANEL -------- */

    #status {
      width: 100%;
      max-width: 500px;
      margin: 26px auto 0;
      text-align: left;
      padding: 20px;
      background: var(--glass);
      border: 1px solid var(--border-glass);
      border-radius: 18px;
      box-shadow: var(--shadow-strong);
    }

    .status-item {
      margin: 8px 0;
      font-size: 0.95rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    #connectionDot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #ff4d4d;
      box-shadow: 0 0 10px rgba(255, 77, 77, 0.8);
    }

    .connected-dot {
      background: #00ff99 !important;
      box-shadow: 0 0 12px rgba(0,255,153,1) !important;
    }

    .connected { color: #00ff99; }
    .disconnected { color: #ff4d4d; }

    footer {
      margin-top: 40px;
      opacity: 0.8;
      font-size: 0.9rem;
    }

    footer {
      text-align: center;
      padding: 30px 20px;
      color: #999;
      font-size: 14px;
      opacity: 0.8;
      background: #0d0d0d;
      margin-top: 40px;
    }
    
  </style>
</head>

<body>
  <h1>ðŸŽ§ BaashaX Watch Together</h1>
  <p class="subtitle">Choose your language and enjoy perfectly synced multilingual audio.</p>

  <!-- LANGUAGE BUTTONS -->
  <div id="languagePanel">
    <button class="language-btn" onclick="joinChannel('tamil')">Tamil</button>
    <button class="language-btn" onclick="joinChannel('kannada')">Kannada</button>
    <button class="language-btn" onclick="joinChannel('hindi')">à¤¹à¤¿à¤‚à¤¦à¥€</button>
  </div>

  <!-- AUDIO CONTROLS -->
  <div id="audioControls">
    <audio id="audioPlayer" controls preload="auto"></audio>
    <button class="sync-btn" onclick="requestSync()">ðŸ”„ Sync Audio</button>
  </div>

  <!-- STATUS PANEL -->
  <div id="status">
    <div class="status-item">
      <div id="connectionDot"></div>
      <div>
        Connection:
        <span id="connectionStatus" class="disconnected">Connecting...</span>
      </div>
    </div>

    <div class="status-item">
      Language: <span id="currentLanguage">None selected</span>
    </div>

<!--    <div class="status-item">-->
<!--      Audio Status: <span id="audioStatus">Ready</span>-->
<!--    </div>-->
  </div>

  <footer>Powered by <b>BaashhaX Player</b> â€¢ Real-time Multilingual Sync</footer>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    /* ---------------- EXACT OLD FUNCTIONALITY ---------------- */

    const socket = io();
    const AUDIO_OFFSET = -0.5;
    const audioPlayer = document.getElementById("audioPlayer");

    /* CONNECTION STATUS */
    socket.on("connect", () => {
      document.getElementById("connectionStatus").textContent = "Connected";
      document.getElementById("connectionStatus").className = "connected";
      document.getElementById("connectionDot").classList.add("connected-dot");
    });

    socket.on("disconnect", () => {
      document.getElementById("connectionStatus").textContent = "Disconnected";
      document.getElementById("connectionStatus").className = "disconnected";
      document.getElementById("connectionDot").classList.remove("connected-dot");
      audioPlayer.pause();
    });

    /* AUDIO URL RECEIVED */
    socket.on("audio-url", (url) => {
      audioPlayer.src = url;
      document.getElementById("audioControls").style.display = "block";
      // document.getElementById("audioStatus").textContent = "Audio loaded";
    });

    /* PLAY */
    socket.on("video-play", (timestamp) => {
      const t = Math.max(0, timestamp + AUDIO_OFFSET);
      audioPlayer.currentTime = t;
      audioPlayer.play();
      document.getElementById("audioStatus").textContent = "Playing";
    });

    /* PAUSE */
    socket.on("video-pause", () => {
      audioPlayer.pause();
      document.getElementById("audioStatus").textContent = "Paused";
    });

    /* SEEK */
    socket.on("video-seek", (timestamp) => {
      const t = Math.max(0, timestamp + AUDIO_OFFSET);
      audioPlayer.currentTime = t;
      document.getElementById("audioStatus").textContent = "Synced";
    });

    /* JOIN CHANNEL */
    function joinChannel(language) {
      document.querySelectorAll(".language-btn").forEach(btn =>
        btn.classList.remove("active")
      );

      const clicked = [...document.querySelectorAll(".language-btn")]
        .find(btn => btn.textContent.toLowerCase().includes(language));

      if (clicked) clicked.classList.add("active");

      socket.emit("join-channel", language);
      document.getElementById("currentLanguage").textContent =
        language.charAt(0).toUpperCase() + language.slice(1);
    }

    /* REQUEST SYNC */
    function requestSync() {
      socket.emit("sync-request");
      document.getElementById("audioStatus").textContent = "Sync requested";
    }
  </script>
</body>
</html>
